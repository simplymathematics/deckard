schema: '2.0'
stages:
  prepare:
    cmd:
    - python ../../deckard/layers/prepare.py  -d 'mnist'
    deps:
    - path: ../../deckard/base/data.py
      md5: 24aeb008f86ce0ed8bfd8586e83dff8a
      size: 12793
    - path: configs/prepare.yml
      md5: bc3ffffb2b9a714eb6401ce7487d7550
      size: 133
    outs:
    - path: data/data.pkl
      md5: dd49b46274a56ed5b6a2b3b116e3cf9e
      size: 635783
  train:
    cmd: python ../../deckard/layers/art_model.py --model_path "https://www.dropbox.com/s/bv1xwjaf1ov4u7y/mnist_ratio%3D0.h5?dl=1"
      --model_name "model.h5" --model_type "tf1" --dataset "data/data.pkl" --output_folder
      "data"
    deps:
    - path: ../../deckard/base/experiment.py
      md5: 763e7886359f44d6d56465c0f8624b61
      size: 23320
    - path: ../../deckard/base/utils.py
      md5: 413d6d5b56f646fdf4f6ec3acc6a6f35
      size: 5913
    - path: ../../deckard/layers/train.py
      md5: d34f8cf9f96eaf14dd80207d49b7f648
      size: 3267
    - path: data/data.pkl
      md5: d444f815853897651cc2c20736ff8c82
      size: 635721
    outs:
    - path: data/best_train/data_params.json
      md5: 7b1a3c4ddfe500e27b2ed691695198ea
      size: 100
    - path: data/best_train/model.h5
      md5: e377e25822be887b27e61df78eee8ce5
      size: 32962000
    - path: data/best_train/results.json
      md5: fd1a55ae60466b90310461173bbc2899
      size: 170
  preprocess:
    cmd: python ../../deckard/layers/preprocess.py  -f data -s f1 -b False --name
      preprocess --input best_train
    deps:
    - path: ../../deckard/layers/preprocess.py
      md5: b93dd7e500d506bd978679bc8752bbef
      size: 2629
    - path: configs/preprocess.yml
      md5: ac4ed79e4a6b628fac4308fdd3e24210
      size: 123
    - path: data/best_train/experiment.pkl
      md5: 36cb3e14b053351585b59d042732c787
      size: 1692746
    outs:
    - path: data/best_preprocess/data_params.json
      md5: d42645342da9e2f0d3c561eadfa7e376
      size: 115
    - path: data/best_preprocess/experiment.pkl
      md5: 279f4e96cf69e0cd6c672189acb250e3
      size: 1690734
    - path: data/best_preprocess/model_params.json
      md5: 799d4480ab6cca99fd5fdf21480b6097
      size: 1528
    - path: data/best_preprocess/results.json
      md5: d8637e70833e2499f3a99889e35755a0
      size: 244
  featurize:
    cmd: python ../../deckard/layers/preprocess.py  -f data -s f1 -b False --name
      featurize --input best_preprocess
    deps:
    - path: ../../deckard/layers/preprocess.py
      md5: b93dd7e500d506bd978679bc8752bbef
      size: 2629
    - path: configs/featurize.yml
      md5: 8e868a26517d7807395016a0b2f60510
      size: 128
    - path: data/best_preprocess/experiment.pkl
      md5: 279f4e96cf69e0cd6c672189acb250e3
      size: 1690734
    outs:
    - path: data/best_featurize/data_params.json
      md5: d42645342da9e2f0d3c561eadfa7e376
      size: 115
    - path: data/best_featurize/experiment.pkl
      md5: c69aef545fda81048b9119d07e7e11f0
      size: 1692650
    - path: data/best_featurize/model_params.json
      md5: a7a8b52e34e18fbabc2ed62edbc17485
      size: 1873
    - path: data/best_featurize/results.json
      md5: 682544741bf8c999bd2eedd1369ba7be
      size: 259
  evaluate:
    cmd: python ../../deckard/layers/evaluate.py -f data -s f1 -d mnist --input best_featurize
    deps:
    - path: data/best_featurize/experiment.pkl
      md5: c69aef545fda81048b9119d07e7e11f0
      size: 1692650
  prepare_data:
    cmd:
    - python ../../deckard/layers/prepare.py  -d 'mnist'
    deps:
    - path: ../../deckard/base/data.py
      md5: 5db4cc1bb4ef42a6718ce4fbe5fb6bbc
      size: 7290
    - path: configs/prepare.yml
      md5: 12c0c368170c5d304326eed4bb808d8a
      size: 122
    outs:
    - path: data/data.pkl
      md5: 42ce1673018ca83c2712c57a02979733
      size: 1957303
  control:
    cmd: python ../../deckard/layers/art_model.py --input_model "https://www.dropbox.com/s/bv1xwjaf1ov4u7y/mnist_ratio%3D0.h5?dl=1"
      --output_name "control_model.pb" --model_type "tf1" --dataset "data/data.pkl"
      --output_folder "data/control"
    deps:
    - path: data/data.pkl
      md5: 42ce1673018ca83c2712c57a02979733
      size: 1957303
    outs:
    - path: data/control/
      md5: fc5f19f1b6cbbf08689c86c87ca65956.dir
      size: 32963284
      nfiles: 5
  defend:
    cmd: python ../../deckard/layers/defend.py --input_model "control_model.pb" --input_folder
      "data/control/" --model_type "tf1" --data_file "data/data.pkl" --output_folder
      "data/defenses/" --output_name "defended_model"
    deps:
    - path: configs/defend.yml
      md5: 1c73d80a7576fbb1e847c863494b55bb
      size: 195
    - path: data/control/
      md5: fc5f19f1b6cbbf08689c86c87ca65956.dir
      size: 32963284
      nfiles: 5
    - path: data/data.pkl
      md5: 42ce1673018ca83c2712c57a02979733
      size: 1957303
    outs:
    - path: data/defenses/
      md5: 1f7829354c3788374f05c28d6988b5f5.dir
      size: 70889135
      nfiles: 19
  attack:
    cmd: python ../../deckard/layers/attack.py --input_model "defended_model" --input_folder
      "data/defenses/" --model_type "tf1" --data_file "data/data.pkl" --output_folder
      "data/attacks/" --output_name "attacked_model"
    deps:
    - path: configs/attack.yml
      md5: 5dc27a223dd2377ea604dff0f1ce782f
      size: 79
    - path: data/data.pkl
      md5: 42ce1673018ca83c2712c57a02979733
      size: 1957303
    - path: data/defenses/
      md5: 1f7829354c3788374f05c28d6988b5f5.dir
      size: 70889135
      nfiles: 19
    outs:
    - path: data/attacks/
      md5: 1e683571c84f7369b9985835fc99a806.dir
      size: 9764
      nfiles: 29
