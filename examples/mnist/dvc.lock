schema: '2.0'
stages:
  prepare:
    cmd: python -m deckard.layers.runner prepare
    params:
      params.yaml:
        data:
          generate:
            n_classes: 3
            n_features: 100
            n_informative: 98
            n_redundant: 1
            n_samples: 10000
          name:
          - classification
          sample:
            random_state: 42
            shuffle: true
            stratify: true
            time_series: true
            train_size: 8000
        files:
          data_file: data\0d2b9fab517f78660b79f4bbb7392769.pickle
          data_filetype: pickle
          data_path: data
          ground_truth_file: ground_truth.json
          model_file: model\0946b5ccd6d0eb16c442b603db474d31.pickle
          model_filetype: pickle
          model_path: model
          params_file: params.json
          path: 07376fbc332b85299463a75113350069
          predictions_file: predictions.json
          probabilities_file: probabilities.json
          reports: reports
          samples_file: samples.json
          score_dict_file: scores.json
          time_dict_file: time_dict.json
    outs:
    - path: prepare/data\0d2b9fab517f78660b79f4bbb7392769.pickle
      md5: 76e3617e72196a2cb820f21be27ecab0
      size: 8040380
  train:
    cmd: python ../../deckard/layers/art_model.py --model_path "https://www.dropbox.com/s/bv1xwjaf1ov4u7y/mnist_ratio%3D0.h5?dl=1"
      --model_name "model.h5" --model_type "tf1" --dataset "data/data.pkl" --output_folder
      "data"
    deps:
    - path: ../../deckard/base/experiment.py
      md5: 763e7886359f44d6d56465c0f8624b61
      size: 23320
    - path: ../../deckard/base/utils.py
      md5: 413d6d5b56f646fdf4f6ec3acc6a6f35
      size: 5913
    - path: ../../deckard/layers/train.py
      md5: d34f8cf9f96eaf14dd80207d49b7f648
      size: 3267
    - path: data/data.pkl
      md5: d444f815853897651cc2c20736ff8c82
      size: 635721
    outs:
    - path: data/best_train/data_params.json
      md5: 7b1a3c4ddfe500e27b2ed691695198ea
      size: 100
    - path: data/best_train/model.h5
      md5: e377e25822be887b27e61df78eee8ce5
      size: 32962000
    - path: data/best_train/results.json
      md5: fd1a55ae60466b90310461173bbc2899
      size: 170
  preprocess:
    cmd: python ../../deckard/layers/preprocess.py  -f data -b False --name preprocess
      --input best_train
    deps:
    - path: ../../deckard/layers/preprocess.py
      md5: b93dd7e500d506bd978679bc8752bbef
      size: 2629
    - path: configs/preprocess.yml
      md5: ac4ed79e4a6b628fac4308fdd3e24210
      size: 123
    - path: data/best_train/experiment.pkl
      md5: 36cb3e14b053351585b59d042732c787
      size: 1692746
    outs:
    - path: data/best_preprocess/data_params.json
      md5: d42645342da9e2f0d3c561eadfa7e376
      size: 115
    - path: data/best_preprocess/experiment.pkl
      md5: 279f4e96cf69e0cd6c672189acb250e3
      size: 1690734
    - path: data/best_preprocess/model_params.json
      md5: 799d4480ab6cca99fd5fdf21480b6097
      size: 1528
    - path: data/best_preprocess/results.json
      md5: d8637e70833e2499f3a99889e35755a0
      size: 244
  featurize:
    cmd: python ../../deckard/layers/preprocess.py  -f data -b False --name featurize
      --input best_preprocess
    deps:
    - path: ../../deckard/layers/preprocess.py
      md5: b93dd7e500d506bd978679bc8752bbef
      size: 2629
    - path: configs/featurize.yml
      md5: 8e868a26517d7807395016a0b2f60510
      size: 128
    - path: data/best_preprocess/experiment.pkl
      md5: 279f4e96cf69e0cd6c672189acb250e3
      size: 1690734
    outs:
    - path: data/best_featurize/data_params.json
      md5: d42645342da9e2f0d3c561eadfa7e376
      size: 115
    - path: data/best_featurize/experiment.pkl
      md5: c69aef545fda81048b9119d07e7e11f0
      size: 1692650
    - path: data/best_featurize/model_params.json
      md5: a7a8b52e34e18fbabc2ed62edbc17485
      size: 1873
    - path: data/best_featurize/results.json
      md5: 682544741bf8c999bd2eedd1369ba7be
      size: 259
  evaluate:
    cmd: python  -m deckard.layers.evaluate --layer_name evaluate
    deps:
    - path: art_model/
      md5: 7a1261ee47f00c5e771bf40433c65f80.dir
      size: 35426899
      nfiles: 10
    - path: attack/
      md5: 5cb00a33ed0c32d30a03991af8d14cc1.dir
      size: 25673542
      nfiles: 13
    - path: defend/
      md5: 4722029587f70c936c3612bb65c86912.dir
      size: 25599789
      nfiles: 10
    - path: prepare/data.pickle
      md5: 4e59a3b535717f8c94defed69fd9068e
      size: 2525426
    params:
      params.yaml:
        evaluate:
          inputs:
            folder: train
            ground_truth: predictions.json
            predictions: ground_truth.json
            classifier: true
            recursive: true
          config:
            name: sklearn.impute.SimpleImputer
            params:
              strategy: mean
          outputs:
            folder: evaluate
            model: model
            params: params.json
          metrics:
            scores: scores.json
    outs:
    - path: evaluate/
      md5: 18691e71aae94afbf3cfd734b6eeeb43.dir
      size: 4
      nfiles: 1
  prepare_data:
    cmd:
    - python ../../deckard/layers/prepare.py
    outs:
    - path: data.pkl
      md5: cdb226f18d6bd132ec336841d2747a62
      size: 5050192
  control:
    cmd: python -m deckard.layers.art_model  --layer_name art_model
    deps:
    - path: prepare/data.pickle
      md5: 0e7d043d25ff91336c6a970c684760ae
      size: 13697693
    params:
      params.yaml:
        art_model:
          inputs:
            folder: .
            data: prepare/data.pickle
            type: tf1
            classifier: true
            is_fitted: true
            url: https://www.dropbox.com/s/bv1xwjaf1ov4u7y/mnist_ratio%3D0.h5?dl=1
          outputs:
            folder: art_model
            model: model
            params: params.json
            ground_truth: ground_truth.json
            predictions: predictions.json
          metrics:
            scores: scores.json
    outs:
    - path: art_model/
      md5: 2dcb6c6f49c4022ea666b6d9b59f62bc.dir
      size: 35807246
      nfiles: 10
  defend:
    cmd: python  -m deckard.layers.defend --layer_name defend
    deps:
    - path: art_model/
      md5: 7a1261ee47f00c5e771bf40433c65f80.dir
      size: 35426899
      nfiles: 10
    - path: prepare/data.pickle
      md5: 4e59a3b535717f8c94defed69fd9068e
      size: 2525426
    params:
      params.yaml:
        defend.config:
          name: art.defences.preprocessor.FeatureSqueezing
          params:
            bit_depth: 8
        defend.inputs:
          folder: .
          data: prepare/data.pickle
          type: tf1
          classifier: true
          is_fitted: false
          model: art_model/model/
    outs:
    - path: defend/
      md5: 4722029587f70c936c3612bb65c86912.dir
      size: 25599789
      nfiles: 10
  attack:
    cmd: python  -m deckard.layers.attack --layer_name attack
    deps:
    - path: defend
      md5: 4722029587f70c936c3612bb65c86912.dir
      size: 25599789
      nfiles: 10
    - path: prepare/data.pickle
      md5: 4e59a3b535717f8c94defed69fd9068e
      size: 2525426
    params:
      params.yaml:
        attack:
          inputs:
            folder: .
            data: prepare/data.pickle
            type: tf1
            classifier: true
            is_fitted: true
            attack_size: 10
            model: defend/model
          config:
            name: art.attacks.evasion.HopSkipJump
            params:
              max_iter: 5
              max_eval: 100
              init_eval: 100
              init_size: 100
          outputs:
            folder: attack
            model: model
            params: params.json
            ground_truth: ground_truth.json
            predictions: predictions.json
          metrics:
            scores: scores.json
    outs:
    - path: attack/
      md5: 5cb00a33ed0c32d30a03991af8d14cc1.dir
      size: 25673542
      nfiles: 13
  art_model:
    cmd: python  -m deckard.layers.art_model --layer_name art_model
    deps:
    - path: prepare/data.pickle
      md5: 4e59a3b535717f8c94defed69fd9068e
      size: 2525426
    params:
      params.yaml:
        art_model:
          inputs:
            folder: .
            data: prepare/data.pickle
            type: tf1
            classifier: true
            is_fitted: true
            url: https://www.dropbox.com/s/bv1xwjaf1ov4u7y/mnist_ratio%3D0.h5?dl=1
          outputs:
            folder: art_model
            model: model
            params: params.json
            ground_truth: ground_truth.json
            predictions: predictions.json
          metrics:
            scores: scores.json
    outs:
    - path: art_model/
      md5: 7a1261ee47f00c5e771bf40433c65f80.dir
      size: 35426899
      nfiles: 10
