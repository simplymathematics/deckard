schema: '2.0'
stages:
  clean@cifar:
    cmd: python -m deckard.layers.clean_data -i data/raw_cifar.csv  -o data/cifar.csv  -c
      ../conf/clean.yaml --drop_if_empty adv_fit_time accuracy train_time predict_time
      adv_accuracy def_value atk_value model_layers
    deps:
    - path: ../conf/clean.yaml
      hash: md5
      md5: 10ef1d8d4899ba2d62ccb186e0d8da44
      size: 964
    - path: data/raw_cifar.csv
      hash: md5
      md5: 9fb240676d1ba7faea366fad55931a01
      size: 26090605
    outs:
    - path: data/cifar.csv
      hash: md5
      md5: 6046192990432683bd028c6014c2d524
      size: 15180787
  clean@mnist:
    cmd: python -m deckard.layers.clean_data -i data/raw_mnist.csv  -o data/mnist.csv  -c
      ../conf/clean.yaml --drop_if_empty adv_fit_time accuracy train_time predict_time
      adv_accuracy def_value atk_value model_layers
    deps:
    - path: ../conf/clean.yaml
      hash: md5
      md5: 10ef1d8d4899ba2d62ccb186e0d8da44
      size: 964
    - path: data/raw_mnist.csv
      hash: md5
      md5: 5b422f124272c3b012f023a354ba2737
      size: 189644858
    outs:
    - path: data/mnist.csv
      hash: md5
      md5: 586800d3545f24e154152aa7f2d302db
      size: 16430553
  clean@cifar100:
    cmd: python -m deckard.layers.clean_data -i data/raw_cifar100.csv  -o data/cifar100.csv  -c
      ../conf/clean.yaml --drop_if_empty adv_fit_time accuracy train_time predict_time
      adv_accuracy def_value atk_value model_layers
    deps:
    - path: ../conf/clean.yaml
      hash: md5
      md5: 10ef1d8d4899ba2d62ccb186e0d8da44
      size: 964
    - path: data/raw_cifar100.csv
      hash: md5
      md5: 8f508ea00d964ebb838f5ad4e678dc44
      size: 36167717
    outs:
    - path: data/cifar100.csv
      hash: md5
      md5: 6e4ab047570ee56ca68413efcf5c18de
      size: 30694004
  merge:
    cmd: python -m deckard.layers.merge --smaller_file data/cifar.csv data/cifar100.csv
      data/mnist.csv  --output_folder data --output_file merged.csv
    deps:
    - path: data/cifar.csv
      hash: md5
      md5: 6046192990432683bd028c6014c2d524
      size: 15180787
    - path: data/cifar100.csv
      hash: md5
      md5: 6e4ab047570ee56ca68413efcf5c18de
      size: 30694004
    - path: data/mnist.csv
      hash: md5
      md5: 586800d3545f24e154152aa7f2d302db
      size: 16430553
    outs:
    - path: data/merged.csv
      hash: md5
      md5: a2aa9ad010b53052ca557049d358d279
      size: 63595566
  afr:
    cmd: python -m deckard.layers.afr  --data_file data/merged.csv  --target adv_failures
      --duration_col adv_fit_time --config_file afr.yaml --plots_folder plots/
    deps:
    - path: data/merged.csv
      hash: md5
      md5: a2aa9ad010b53052ca557049d358d279
      size: 63595566
    params:
      afr.yaml:
        covariates:
        - adv_fit_time
        - accuracy
        - train_time
        - atk_value
        - def_value
        - Epochs
        - model_layers
        - id
        - atk_gen
        - def_gen
        - adv_failures
        - adv_accuracy
        - predict_time
        dummies:
          atk_gen: 'Atk:'
          def_gen: 'Def:'
          id: 'Data:'
        exponential:
          plot:
            file: exponential_aft.pdf
            title: Exponential Model
            qq_title: Exponential QQ Plot
          t0: 0.1
          model:
            breakpoints:
            - 0.1
          labels:
            'Intercept: rho_': $\rho$
            'Intercept: lambda_': $\lambda$
            'atk_value: lambda_': Attack Strength
            'def_value: lambda_': Defence Strength
            'model_layers: lambda_': Layers
            'train_time: lambda_': $T_{train}$
            'predict_time: lambda_': $T_{predict}$
            'adv_accuracy: lambda_': Adv. Accuracy
            'accuracy: lambda_': Ben. Accuracy
            'Epochs: lambda_': No. of Epochs
            def_gen: Defence
            ': lambda_': ''
        log_logistic:
          plot:
            file: log_logistic_aft.pdf
            title: Log logistic AFT Model
            qq_title: Log Logistic QQ Plot
          t0: 1
          model:
            penalizer: 0.2
          labels:
            'Intercept: beta_': $\beta$
            'Intercept: alpha_': $\alpha$
            'data.sample.random_state: alpha_': Random State
            'atk_value: alpha_': Attack Strength
            'def_value: alpha_': Defence Strength
            'model_layers: alpha_': Layers
            'train_time: alpha_': $T_{train}$
            'predict_time: alpha_': $T_{predict}$
            'adv_accuracy: alpha_': Adv. Accuracy
            'accuracy: alpha_': Ben. Accuracy
            'Epochs: alpha_': No. of Epochs
            def_gen: Defence
        log_normal:
          plot:
            file: log_normal_aft.pdf
            title: Log Normal AFT Model
            qq_title: Log Normal QQ Plot
          t0: 2
          model:
            penalizer: 0.5
          labels:
            'Intercept: sigma_': $\sigma$
            'Intercept: mu_': $\mu$
            'atk_value: mu_': Attack Strength
            'def_value: mu_': Defence Strength
            'model_layers: mu_': Layers
            'train_time: mu_': $T_{train}$
            'predict_time: mu_': $T_{predict}$
            'adv_accuracy: mu_': Adv. Accuracy
            'accuracy: mu_': Ben. Accuracy
            'adv_failure_rate: mu_': $h_{adv.}(t;\theta)$
            'failure_rate: mu_': $h_{ben.}(t;\theta)$
            'Epochs: mu_': No. of Epochs
            'model.trainer.batch_size: mu_': Batch Size
            def_gen: Defence
            'attack.init.eps: mu_': $\varepsilon$
            'data.sample.random_state: mu_': Random State
        weibull:
          plot:
            file: weibull_aft.pdf
            title: Weibull AFT Model
            qq_title: Weibull QQ Plot
          t0: 0.3
          model:
            penalizer: 0.1
          labels:
            'Intercept: rho_': $\rho$
            'Intercept: lambda_': $\lambda$
            'data.sample.random_state: lambda_': Random State
            'atk_value: lambda_': Attack Strength
            'model_layers: lambda_': Layers
            'train_time: lambda_': $T_{train}$
            'predict_time: lambda_': $T_{predict}$
            'adv_accuracy: lambda_': Adv. Accuracy
            'accuracy: lambda_': Ben. Accuracy
            'Epochs: lambda_': No. of Epochs
            'model.trainer.batch_size: lambda_': Batch Size
            def_gen: Defence
            'def_value: lambda_': Defence Strength
            ': lambda_': ''
    outs:
    - path: plots/aft_comparison.csv
      hash: md5
      md5: 1c4be89b559377047dce7cb4012c78d0
      size: 278
    - path: plots/aft_comparison.tex
      hash: md5
      md5: f0d088be364561ae11e945983d74175b
      size: 516
    - path: plots/exponential_aft.pdf
      hash: md5
      md5: 04c76870c45a2a23dede32f6fe2668e1
      size: 32129
    - path: plots/exponential_aft_dummies.pdf
      hash: md5
      md5: 5f9ddb30cb95134e9361460b479d5c1e
      size: 32749
    - path: plots/exponential_qq.pdf
      hash: md5
      md5: 123ce8b8cf829757145d7474e5f07533
      size: 21550
    - path: plots/exponential_summary.csv
      hash: md5
      md5: 41de09ded8b0876ebf3b26a47a8d371f
      size: 7901
    - path: plots/log_logistic_aft.pdf
      hash: md5
      md5: c8f0a68e5ef1beac46aac7d02006a60c
      size: 30575
    - path: plots/log_logistic_aft_dummies.pdf
      hash: md5
      md5: 4b4f3e05d7dda92b7e3412cddd40d6bc
      size: 32189
    - path: plots/log_logistic_qq.pdf
      hash: md5
      md5: 482aa8a9f6f6131d5580a3a106e25546
      size: 18236
    - path: plots/log_logistic_summary.csv
      hash: md5
      md5: 60006e754929a31dde9ab6572920f694
      size: 4635
    - path: plots/log_normal_aft.pdf
      hash: md5
      md5: 561f5a385f7855f2559374aea3340dfd
      size: 30970
    - path: plots/log_normal_aft_dummies.pdf
      hash: md5
      md5: 114a5cd578c02a709a1e3d0933dc24df
      size: 32552
    - path: plots/log_normal_qq.pdf
      hash: md5
      md5: afb8f166ef836ac4a88ddea2795ebc87
      size: 21730
    - path: plots/log_normal_summary.csv
      hash: md5
      md5: 6e218c82b3387e85bc46187bbe34c176
      size: 4469
    - path: plots/weibull_aft.pdf
      hash: md5
      md5: 86912a0693e30b9ef19b97a1711c70d2
      size: 30622
    - path: plots/weibull_aft_dummies.pdf
      hash: md5
      md5: 5f067ce81b52add99c436fe810cc604c
      size: 31805
    - path: plots/weibull_qq.pdf
      hash: md5
      md5: ec05acf9a8a2b5bac6177803dc3a85cf
      size: 18213
    - path: plots/weibull_summary.csv
      hash: md5
      md5: 9fd070355354596ebc6c86765a2ff71b
      size: 4953
  predict_survival_time:
    cmd: python predict_with_best.py  --data data/merged.csv  --config_file afr.yaml  --model
      weibull  --target adv_failures  --duration_col adv_fit_time --output data/merged_afr.csv
    deps:
    - path: afr.yaml
      hash: md5
      md5: 7395e3bb0b5549382a4a07bdc6d44023
      size: 5068
    - path: data/merged.csv
      hash: md5
      md5: a2aa9ad010b53052ca557049d358d279
      size: 63595566
    - path: plots/aft_comparison.tex
      hash: md5
      md5: f0d088be364561ae11e945983d74175b
      size: 516
    - path: predict_with_best.py
      hash: md5
      md5: 33d068d06d1c29f6838fc6667353b9ec
      size: 2608
    outs:
    - path: data/merged_afr.csv
      hash: md5
      md5: e4b50a23d20cf4da115b497ce78fb9ea
      size: 64561246
  plot:
    cmd: python -m deckard.layers.plots --path plots/ --file data/merged_afr.csv -c
      plots.yaml
    deps:
    - path: data/merged_afr.csv
      hash: md5
      md5: e4b50a23d20cf4da115b497ce78fb9ea
      size: 64561246
    - path: plots.yaml
      hash: md5
      md5: a0c5c100248543bb5f0de8949b459bc5
      size: 3815
    params:
      afr.yaml:
        covariates:
        - adv_fit_time
        - accuracy
        - train_time
        - atk_value
        - def_value
        - Epochs
        - model_layers
        - id
        - atk_gen
        - def_gen
        - adv_failures
        - adv_accuracy
        - predict_time
        weibull:
          plot:
            file: weibull_aft.pdf
            title: Weibull AFT Model
            qq_title: Weibull QQ Plot
          t0: 0.3
          model:
            penalizer: 0.1
          labels:
            'Intercept: rho_': $\rho$
            'Intercept: lambda_': $\lambda$
            'data.sample.random_state: lambda_': Random State
            'atk_value: lambda_': Attack Strength
            'model_layers: lambda_': Layers
            'train_time: lambda_': $T_{train}$
            'predict_time: lambda_': $T_{predict}$
            'adv_accuracy: lambda_': Adv. Accuracy
            'accuracy: lambda_': Ben. Accuracy
            'Epochs: lambda_': No. of Epochs
            'model.trainer.batch_size: lambda_': Batch Size
            def_gen: Defence
            'def_value: lambda_': Defence Strength
            ': lambda_': ''
      plots.yaml:
        cat_plot:
        - file: adv_accuracy_vs_defence_type.pdf
          hue: model_name
          kind: boxen
          set:
            yscale: linear
          x: def_gen
          xlabels: Defence Type
          y: adv_accuracy
          ylabels: Adv. Accuracy
          rotation: 90
          hue_order:
          - ResNet18
          - ResNet34
          - ResNet50
          - ResNet101
          - ResNet152
          legend_title: Model
        - file: ben_accuracy_vs_defence_type.pdf
          hue: model_name
          kind: boxen
          x: def_gen
          xlabels: Defence Type
          y: accuracy
          ylabels: Ben. Accuracy
          rotation: 90
          hue_order:
          - ResNet18
          - ResNet34
          - ResNet50
          - ResNet101
          - ResNet152
          legend_title: Model
        - file: trash_score_vs_defence_type.pdf
          hue: model_name
          kind: boxen
          set:
            yscale: log
          x: def_gen
          xlabels: Defence Type
          y: c_adv
          ylabels: $\bar{C}_{adv.}$
          rotation: 90
          hue_order:
          - ResNet18
          - ResNet34
          - ResNet50
          - ResNet101
          - ResNet152
          legend_title: Model
        - file: trash_score_vs_attack_type.pdf
          hue: model_name
          kind: boxen
          set:
            yscale: log
          x: atk_gen
          xlabels: Attack Type
          y: c_adv
          ylabels: $\bar{C}_{adv.}$
          rotation: 90
          hue_order:
          - ResNet18
          - ResNet34
          - ResNet50
          - ResNet101
          - ResNet152
          legend_title: Model
        - file: adv_accuracy_vs_attack_type.pdf
          hue: model_name
          kind: boxen
          x: atk_gen
          xlabels: Attack Type
          y: adv_accuracy
          ylabels: Adv. Accuracy
          rotation: 90
          hue_order:
          - ResNet18
          - ResNet34
          - ResNet50
          - ResNet101
          - ResNet152
          legend_title: Model
        line_plot:
        - file: def_param_vs_accuracy.pdf
          hue: def_gen
          legend:
            bbox_to_anchor:
            - 1.05
            - 1
            title: Defence
          title: Ben. Accuracy vs Defence Strength
          x: def_value
          x_scale: linear
          xlabel: Defence Control Parameter
          y: accuracy
          y_scale:
          ylabel: Ben. Accuracy
          hue_order:
          - Control
          - Conf
          - Gauss-in
          - Gauss-out
          - FSQ
          errorbar: se
          err_style: bars
        - file: def_param_vs_adv_accuracy.pdf
          hue: def_gen
          legend:
            bbox_to_anchor:
            - 1.05
            - 1
            title: Defence
          title: Adv. Accuracy vs Defence Strength
          x: def_value
          x_scale: linear
          xlabel: Defence Control Parameter
          y: adv_accuracy
          y_scale:
          ylabel: Adv. Accuracy
          hue_order:
          - Control
          - Conf
          - Gauss-in
          - Gauss-out
          - FSQ
          errorbar: se
          err_style: bars
        - file: def_param_vs_adv_failure_rate.pdf
          hue: def_gen
          legend:
            bbox_to_anchor:
            - 1.05
            - 1
            title: Defence
          title: $f_{adv}$ vs Defence Strength
          x: def_value
          x_scale: linear
          xlabel: Defence Control Parameter
          y: adv_failure_rate
          y_scale: linear
          ylabel: $f_{adv.}$
          hue_order:
          - Control
          - Conf
          - Gauss-in
          - Gauss-out
          - FSQ
          errorbar: se
          err_style: bars
        - file: atk_param_vs_accuracy.pdf
          hue: atk_gen
          legend:
            bbox_to_anchor:
            - 1.05
            - 1
          title: Adv. Accuracy vs Attack Strength
          x: atk_value
          x_scale: linear
          xlabel: Attack Control Parameter
          y: adv_accuracy
          y_scale:
          ylabel: Adv. Accuracy
          hue_order:
          - FGM
          - PGD
          - Deep
          - HSJ
          - Pixel
          - Thresh
          errorbar: se
          err_style: bars
        scatter_plot:
        - x: train_time_per_sample
          y: adv_failure_rate
          hue: model_name
          xlabel: $t_{train}$
          ylabel: $f_{adv}$
          title: $f_{adv}$ vs $t_{train}$
          file: adv_failure_rate_vs_train_time.pdf
          x_scale: log
          legend:
            title: Model Name
            bbox_to_anchor:
            - 1.05
            - 1
          hue_order:
          - ResNet18
          - ResNet34
          - ResNet50
          - ResNet101
          - ResNet152
    outs:
    - path: plots/adv_accuracy_vs_attack_type.pdf
      hash: md5
      md5: a6abac11cca1d994449c784a88505d3b
      size: 35388
    - path: plots/adv_accuracy_vs_defence_type.pdf
      hash: md5
      md5: 7a6fb7f505c503f9f5f380b696909898
      size: 32577
    - path: plots/adv_failure_rate_vs_train_time.pdf
      hash: md5
      md5: df4e8aafdbdbea4b2fa0c30a4267b290
      size: 227971
    - path: plots/atk_param_vs_accuracy.pdf
      hash: md5
      md5: 8d902a778eba7136a335656002307138
      size: 21456
    - path: plots/ben_accuracy_vs_defence_type.pdf
      hash: md5
      md5: 466448b6cb52a03e7a49517607b766bc
      size: 34391
    - path: plots/def_param_vs_accuracy.pdf
      hash: md5
      md5: 17de0839784953fb96282cbf6e82d900
      size: 19249
    - path: plots/def_param_vs_adv_accuracy.pdf
      hash: md5
      md5: 81552ad32ff90bad79421ac01eba6b00
      size: 18809
    - path: plots/def_param_vs_adv_failure_rate.pdf
      hash: md5
      md5: ed790a2bef5071d2f91c03b850787fa7
      size: 22067
    - path: plots/trash_score_vs_attack_type.pdf
      hash: md5
      md5: 3655683ffd2c33d422dd5c5232e3c9cc
      size: 45212
    - path: plots/trash_score_vs_defence_type.pdf
      hash: md5
      md5: 5d084d5bd81c346d1803474519a5c3f8
      size: 41550
  copy_results:
    cmd: mkdir -p ~/ml_afr/plots &&  cp -r plots/* ~/ml_afr/plots/
    deps:
    - path: plots/
      hash: md5
      md5: 9b1b5930ac632f16ec2dd807d8d0043a.dir
      size: 925186
      nfiles: 32
