schema: '2.0'
stages:
  merge:
    cmd: python -m deckard.layers.merge --smaller_file data/cifar.csv data/cifar100.csv
      data/mnist.csv  --output_folder data --output_file merged.csv
    deps:
    - path: data/cifar.csv
      hash: md5
      md5: 4c6e158a421999f4eae6c238395f63e4
      size: 20578565
    - path: data/cifar100.csv
      hash: md5
      md5: c7bbce2ed692f4697b9ab4cbbe36f9c9
      size: 30226661
    - path: data/mnist.csv
      hash: md5
      md5: 083e65989c7b8a5f103d407eb675aaf8
      size: 70077338
    outs:
    - path: data/merged.csv
      hash: md5
      md5: f98b901fa3ee817a55a36f78d0c95233
      size: 124219079
  plot:
    cmd: python -m deckard.layers.plots --path plots/ --file data/merged_afr.csv -c
      plots.yaml
    deps:
    - path: data/merged_afr.csv
      hash: md5
      md5: e8c06cf834297c5ee44950ea4d640cc8
      size: 125347398
    - path: plots.yaml
      hash: md5
      md5: 0f349596bdb4c2cee3c462325dffe4ba
      size: 5070
    params:
      plots.yaml:
        cat_plot:
        - file: adv_accuracy_vs_defence_type.pdf
          hue: model_name
          kind: boxen
          set:
            yscale: linear
          x: def_gen
          xlabels: Defence Type
          y: adv_accuracy
          ylabels: Adv. Accuracy
          rotation: 90
          hue_order:
          - ResNet18
          - ResNet34
          - ResNet50
          - ResNet101
          - ResNet152
          legend_title: Model
        - file: ben_accuracy_vs_defence_type.pdf
          hue: model_name
          kind: boxen
          x: def_gen
          xlabels: Defence Type
          y: accuracy
          ylabels: Ben. Accuracy
          rotation: 90
          hue_order:
          - ResNet18
          - ResNet34
          - ResNet50
          - ResNet101
          - ResNet152
          legend_title: Model
        - file: ben_failures_per_train_time_vs_defence_type.pdf
          hue: model_name
          kind: boxen
          set:
            yscale: log
          x: def_gen
          xlabels: Defence Type
          y: c_ben
          ylabels: $\bar{C}_{ben.}$
          rotation: 90
          hue_order:
          - ResNet18
          - ResNet34
          - ResNet50
          - ResNet101
          - ResNet152
          legend_title: Model
        - file: adv_failures_per_train_time_vs_defence_type.pdf
          hue: model_name
          kind: boxen
          set:
            yscale: log
          x: def_gen
          xlabels: Defence Type
          y: c_adv
          ylabels: $\bar{C}_{adv.}$
          rotation: 90
          hue_order:
          - ResNet18
          - ResNet34
          - ResNet50
          - ResNet101
          - ResNet152
          legend_title: Model
        - file: adv_failures_per_train_time_vs_attack_type.pdf
          hue: model_name
          kind: boxen
          set:
            yscale: log
          x: atk_gen
          xlabels: Attack Type
          y: c_adv
          ylabels: $\bar{C}_{adv.}$
          rotation: 90
          hue_order:
          - ResNet18
          - ResNet34
          - ResNet50
          - ResNet101
          - ResNet152
          legend_title: Model
        - file: adv_failures_per_test_time_vs_defence_type.pdf
          hue: model_name
          kind: boxen
          x: def_gen
          xlabels: Defence Type
          y: adv_failure_rate
          ylabels: $f_{adv.}$
          rotation: 90
          hue_order:
          - ResNet18
          - ResNet34
          - ResNet50
          - ResNet101
          - ResNet152
          legend_title: Model
        - file: adv_accuracy_vs_attack_type.pdf
          hue: model_name
          kind: boxen
          x: atk_gen
          xlabels: Attack Type
          y: adv_accuracy
          ylabels: Adv. Accuracy
          rotation: 90
          hue_order:
          - ResNet18
          - ResNet34
          - ResNet50
          - ResNet101
          - ResNet152
          legend_title: Model
        - file: ben_failure_rate_vs_defence_type.pdf
          hue: model_name
          kind: boxen
          set:
            yscale: log
          x: def_gen
          xlabels: Defence Type
          y: failure_rate
          ylabels: $f_{ben}(t; \theta)$
          rotation: 90
          hue_order:
          - ResNet18
          - ResNet34
          - ResNet50
          - ResNet101
          - ResNet152
          legend_title: Model
        line_plot:
        - file: def_param_vs_accuracy.pdf
          hue: def_gen
          legend:
            bbox_to_anchor:
            - 1.05
            - 1
            title: Defence
          title: Ben. Accuracy vs Defence Strength
          x: def_value
          x_scale: linear
          xlabel: Defence Control Parameter
          y: accuracy
          y_scale:
          ylabel: Ben. Accuracy
          hue_order:
          - Control
          - Conf
          - Gauss-in
          - Gauss-out
          - FSQ
          errorbar: se
          err_style: bars
        - file: def_param_vs_adv_accuracy.pdf
          hue: def_gen
          legend:
            bbox_to_anchor:
            - 1.05
            - 1
            title: Defence
          title: Adv. Accuracy vs Defence Strength
          x: def_value
          x_scale: linear
          xlabel: Defence Control Parameter
          y: adv_accuracy
          y_scale:
          ylabel: Adv. Accuracy
          hue_order:
          - Control
          - Conf
          - Gauss-in
          - Gauss-out
          - FSQ
          errorbar: se
          err_style: bars
        - file: def_param_vs_adv_failure_rate.pdf
          hue: def_gen
          legend:
            bbox_to_anchor:
            - 1.05
            - 1
            title: Defence
          title: $f_{adv}$ vs Defence Strength
          x: def_value
          x_scale: linear
          xlabel: Defence Control Parameter
          y: adv_failure_rate
          y_scale: linear
          ylabel: $f_{adv.}$
          hue_order:
          - Control
          - Conf
          - Gauss-in
          - Gauss-out
          - FSQ
          errorbar: se
          err_style: bars
        - file: atk_param_vs_accuracy.pdf
          hue: atk_gen
          legend:
            bbox_to_anchor:
            - 1.05
            - 1
          title: Adv. Accuracy vs Attack Strength
          x: atk_value
          x_scale: linear
          xlabel: Attack Control Parameter
          y: adv_accuracy
          y_scale:
          ylabel: Adv. Accuracy
          hue_order:
          - FGM
          - PGD
          - Deep
          - HSJ
          - Pixel
          - Thresh
          errorbar: se
          err_style: bars
        scatter_plot:
        - x: train_time_per_sample
          y: adv_failure_rate
          hue: model_name
          xlabel: $t_{train}$
          ylabel: $f_{adv}$
          title: $f_{adv}$ vs $t_{train}$
          file: adv_failure_rate_vs_train_time.pdf
          x_scale: log
          legend:
            title: Model Name
            bbox_to_anchor:
            - 1.05
            - 1
          hue_order:
          - ResNet18
          - ResNet34
          - ResNet50
          - ResNet101
          - ResNet152
    outs:
    - path: plots/adv_accuracy_vs_attack_type.pdf
      hash: md5
      md5: b50cf3921717ba07b56949f72573a61b
      size: 36004
    - path: plots/adv_accuracy_vs_defence_type.pdf
      hash: md5
      md5: 377bb7cfca86b811ae86c2687ab4f6b8
      size: 33276
    - path: plots/adv_failure_rate_vs_train_time.pdf
      hash: md5
      md5: 8fdbb1494e99fe21907c2d446bb62a47
      size: 276434
    - path: plots/adv_failures_per_test_time_vs_defence_type.pdf
      hash: md5
      md5: e16d543d18c857d2ab1a055790ac9cb4
      size: 41070
    - path: plots/adv_failures_per_train_time_vs_attack_type.pdf
      hash: md5
      md5: 55c82ce0878bb3474db9fc430b60ae2b
      size: 45248
    - path: plots/adv_failures_per_train_time_vs_defence_type.pdf
      hash: md5
      md5: 13e9539146f84a1b4afbd7cce9cf95d1
      size: 41334
    - path: plots/atk_param_vs_accuracy.pdf
      hash: md5
      md5: 6ef8565423bb006e8639b13c00e654bb
      size: 21456
    - path: plots/ben_accuracy_vs_defence_type.pdf
      hash: md5
      md5: f48fdc95b029fa40f076cc316fb21569
      size: 34713
    - path: plots/ben_failure_rate_vs_defence_type.pdf
      hash: md5
      md5: 17fdbd0c10b0d254725decc960bf85b2
      size: 43727
    - path: plots/ben_failures_per_train_time_vs_defence_type.pdf
      hash: md5
      md5: 3d1a9e4d27c744b31ffe71fd5d2f19ff
      size: 41312
    - path: plots/def_param_vs_accuracy.pdf
      hash: md5
      md5: 63828296fe3ac8b18b8ef83240ffd3de
      size: 19260
    - path: plots/def_param_vs_adv_accuracy.pdf
      hash: md5
      md5: 95c7e67f37ae011cac3b7b073f2cb9d3
      size: 18821
    - path: plots/def_param_vs_adv_failure_rate.pdf
      hash: md5
      md5: e06f030fbac5dbaa57b216e7476f4e77
      size: 23053
  afr:
    cmd: python -m deckard.layers.afr  --data_file data/merged.csv  --target adv_failures
      --duration_col adv_fit_time  --config_file afr.yaml --plots_folder plots/
    deps:
    - path: data/merged.csv
      hash: md5
      md5: f98b901fa3ee817a55a36f78d0c95233
      size: 124219079
    params:
      afr.yaml:
        covariates:
        - adv_fit_time
        - accuracy
        - train_time
        - atk_value
        - def_value
        - data.sample.random_state
        - Epochs
        - model_layers
        - id
        - atk_gen
        - def_gen
        - adv_failures
        - adv_accuracy
        - predict_time
        cox:
          plot:
            file: cox_aft.pdf
            title: Cox Model
            qq_title: Cox QQ Plot
          t0: 0.3
          model:
            penalizer: 0.2
          labels:
            'Intercept: rho_': $\rho$
            'Intercept: lambda_': $\lambda$
            'data.sample.random_state: lambda_': Random State
            'atk_value: lambda_': Attack Strength
            'train_time: lambda_': $t_{train}$
            'predict_proba_time: lambda_': $t_{predict}$
            'adv_accuracy: lambda_': Adv. Accuracy
            'accuracy: lambda_': Ben. Accuracy
            'adv_fit_time: lambda_': $t_{attack}$
            'adv_failure_rate: lambda_': $f_{adv.}(t;\theta)$
            'failure_rate: lambda_': $f_{ben.}(t;\theta)$
            'Epochs: lambda_': No. of Epochs
            'model.trainer.batch_size: lambda_': Batch Size
            def_gen: Defence
        log_logistic:
          plot:
            file: log_logistic_aft.pdf
            title: Log logistic AFR Model
            qq_title: Log Logistic QQ Plot
          t0: 0.1
          model:
            penalizer: 0.1
          labels:
            'Intercept: beta_': $\beta$
            'Intercept: alpha_': $\alpha$
            'data.sample.random_state: alpha_': Random State
            'atk_value: alpha_': Attack Strength
            'train_time: alpha_': $t_{train}$
            'predict_proba_time: alpha_': $t_{predict}$
            'adv_accuracy: alpha_': Adv. Accuracy
            'accuracy: alpha_': Ben. Accuracy
            'adv_fit_time: alpha_': $t_{attack}$
            'adv_failure_rate: alpha_': $h_{adv.}(t;\theta)$
            'failure_rate: alpha_': $h_{ben.}(t;\theta)$
            'Epochs: alpha_': No. of Epochs
            'model.trainer.batch_size: alpha_': Batch Size
            def_gen: Defence
            'attack.init.eps: alpha_': $\varepsilon$
        log_normal:
          plot:
            file: log_normal_aft.pdf
            title: Log Normal AFR Model
            qq_title: Log Normal QQ Plot
          t0: 2
          model:
            penalizer: 0.5
          labels:
            'Intercept: sigma_': $\sigma$
            'Intercept: mu_': $\mu$
            'atk_value: mu_': Attack Strength
            'train_time: mu_': $t_{train}$
            'predict_proba_time: mu_': $t_{predict}$
            'adv_accuracy: mu_': Adv. Accuracy
            'accuracy: mu_': Ben. Accuracy
            'adv_fit_time: mu_': $t_{attack}$
            'adv_failure_rate: mu_': $h_{adv.}(t;\theta)$
            'failure_rate: mu_': $h_{ben.}(t;\theta)$
            'Epochs: mu_': No. of Epochs
            'model.trainer.batch_size: mu_': Batch Size
            def_gen: Defence
            'attack.init.eps: mu_': $\varepsilon$
            'data.sample.random_state: mu_': Random State
        weibull:
          plot:
            file: weibull_aft.pdf
            title: Weibull AFR Model
            qq_title: Weibull QQ Plot
          t0: 1
          model:
            penalizer: 0.1
          labels:
            'Intercept: rho_': $\rho$
            'Intercept: lambda_': $\lambda$
            'data.sample.random_state: lambda_': Random State
            'atk_value: lambda_': Attack Strength
            'train_time: lambda_': $t_{train}$
            'predict_proba_time: lambda_': $t_{predict}$
            'adv_accuracy: lambda_': Adv. Accuracy
            'accuracy: lambda_': Ben. Accuracy
            'adv_fit_time: lambda_': $t_{attack}$
            'adv_failure_rate: lambda_': $f_{adv.}(t;\theta)$
            'failure_rate: lambda_': $f_{ben.}(t;\theta)$
            'Epochs: lambda_': No. of Epochs
            'model.trainer.batch_size: lambda_': Batch Size
            def_gen: Defence
            'model_layers: lambda_': Layers
            'def_value: lambda_': Defence Strength
            'predict_time: lambda_': $t_{predict}$
            ': lambda_': ''
    outs:
    - path: plots/aft_comparison.csv
      hash: md5
      md5: bfcc8764d4dcd3028ad43ce8d5a962cf
      size: 386
    - path: plots/aft_comparison.tex
      hash: md5
      md5: f7fe1ebf5518ed3821836ec5eb607381
      size: 648
    - path: plots/cox_aft.pdf
      hash: md5
      md5: 0dc52a1029dc17fe5454887dbdfa0329
      size: 24579
    - path: plots/cox_aft_dummies.pdf
      hash: md5
      md5: 06ef8d24760921e25147de3dfa7cd2f0
      size: 29294
    - path: plots/cox_qq.pdf
      hash: md5
      md5: 7c45ce9e0358a88c0d17119d20aad264
      size: 19798
    - path: plots/cox_summary.csv
      hash: md5
      md5: c8c465a0e9487619a67343d9333535cf
      size: 4707
    - path: plots/exponential_aft.pdf
      hash: md5
      md5: 257d21c12fdd31b12fd5978c3565e67e
      size: 31716
    - path: plots/exponential_aft_dummies.pdf
      hash: md5
      md5: 9e16ddf9268254c5d5fc51f5d3b96925
      size: 32073
    - path: plots/exponential_qq.pdf
      hash: md5
      md5: 3ae643984876cf12448594c48e85ab9e
      size: 20356
    - path: plots/exponential_summary.csv
      hash: md5
      md5: c2c8d37538826096885429f7dde093c7
      size: 8025
    - path: plots/gamma_aft.pdf
      hash: md5
      md5: cfffa5666c2e0ea82b0dba8ada44723c
      size: 28182
    - path: plots/gamma_aft_dummies.pdf
      hash: md5
      md5: 085fe434119d6b527e539d945d93c48f
      size: 34404
    - path: plots/gamma_qq.pdf
      hash: md5
      md5: 5cb87b50555ed8855f4f736f745e393c
      size: 19161
    - path: plots/gamma_summary.csv
      hash: md5
      md5: 1828b81416fe46a829d0c6c772a8f5f4
      size: 14201
    - path: plots/log_logistic_aft.pdf
      hash: md5
      md5: 49c1a29dc4602747131d634c49faf015
      size: 29805
    - path: plots/log_logistic_aft_dummies.pdf
      hash: md5
      md5: 1cee7dff85557ed581c19622a2c8e6eb
      size: 30815
    - path: plots/log_logistic_qq.pdf
      hash: md5
      md5: 6cc9975b1a2e58f3d85713e79833c920
      size: 21187
    - path: plots/log_logistic_summary.csv
      hash: md5
      md5: bc339874fa9cb8aa52471140047bab73
      size: 5167
    - path: plots/log_normal_aft.pdf
      hash: md5
      md5: f9e2ec9f97e54b4ad37ec9aea580dcc6
      size: 30291
    - path: plots/log_normal_aft_dummies.pdf
      hash: md5
      md5: 60e5cd5a3eca81b23e37851630272cce
      size: 31496
    - path: plots/log_normal_qq.pdf
      hash: md5
      md5: d80033f8fe7ab89fa9ff260e31b08821
      size: 22085
    - path: plots/log_normal_summary.csv
      hash: md5
      md5: d48ff310a60a8ad40313cf3b69ab5e58
      size: 5149
    - path: plots/weibull_aft.pdf
      hash: md5
      md5: db74bb7eb03f8efc9e396a11c9e49fc3
      size: 31698
    - path: plots/weibull_aft_dummies.pdf
      hash: md5
      md5: 512d06e8a8e2287088f3e80626524f09
      size: 31043
    - path: plots/weibull_qq.pdf
      hash: md5
      md5: db674869be12950c9ebf6d9cea019339
      size: 19374
    - path: plots/weibull_summary.csv
      hash: md5
      md5: 8ee7e7d66bcf24eb8424460826ab7421
      size: 5217
  copy_results:
    cmd: mkdir -p ~/ml_afr/plots &&  cp -r plots/* ~/ml_afr/plots/
    deps:
    - path: plots/
      hash: md5
      md5: f78c54029002c1e9256930493364ca46.dir
      size: 1206585
      nfiles: 40
  clean:
    cmd: python -m deckard.layers.clean_data -i data/merged.csv -o data/clean.csv
      -c clean.yaml
    deps:
    - path: data/merged.csv
      hash: md5
      md5: 1b4802747f91a7001c43401ad21d997a
      size: 50761113
    params:
      clean.yaml:
        fillna:
          Epochs: 10
    outs:
    - path: data/clean.csv
      hash: md5
      md5: 2913117ef7997065dafc860c9d3080f5
      size: 54972304
  clean@mnist:
    cmd: python -m deckard.layers.clean_data -i data/attack_mnist.csv  -o data/mnist.csv  -c
      ../conf/clean_mnist.yaml --drop_if_empty adv_fit_time accuracy train_time predict_time
      adv_accuracy Epochs
    deps:
    - path: ../conf/clean_mnist.yaml
      hash: md5
      md5: bb112947b87ca42a244135a52cc5e7d5
      size: 1003
    - path: data/attack_mnist.csv
      hash: md5
      md5: c4db49ae4fc1a0e6fa4c3d52b03d650a
      size: 93006845
    outs:
    - path: data/mnist.csv
      hash: md5
      md5: 083e65989c7b8a5f103d407eb675aaf8
      size: 70077338
  clean@cifar:
    cmd: python -m deckard.layers.clean_data -i data/attack_cifar.csv  -o data/cifar.csv  -c
      ../conf/clean_cifar.yaml --drop_if_empty adv_fit_time accuracy train_time predict_time
      adv_accuracy Epochs
    deps:
    - path: ../conf/clean_cifar.yaml
      hash: md5
      md5: 4e2abc093db66b77b424854549b80497
      size: 961
    - path: data/attack_cifar.csv
      hash: md5
      md5: 5a430aa13b88dff6a8fdf0277c9cd53d
      size: 23267442
    outs:
    - path: data/cifar.csv
      hash: md5
      md5: 4c6e158a421999f4eae6c238395f63e4
      size: 20578565
  clean@cifar100:
    cmd: python -m deckard.layers.clean_data -i data/attack_cifar100.csv  -o data/cifar100.csv  -c
      ../conf/clean_cifar100.yaml --drop_if_empty adv_fit_time accuracy train_time
      predict_time adv_accuracy Epochs
    deps:
    - path: ../conf/clean_cifar100.yaml
      hash: md5
      md5: 5a8cc7e71f7036e2f590bb882acd34fb
      size: 897
    - path: data/attack_cifar100.csv
      hash: md5
      md5: ea55355b5b530f5751aea19d13067099
      size: 36035453
    outs:
    - path: data/cifar100.csv
      hash: md5
      md5: c7bbce2ed692f4697b9ab4cbbe36f9c9
      size: 30226661
  predict_survival_time:
    cmd: python predict_with_best.py  --data data/merged.csv  --config_file afr.yaml  --model
      weibull  --target adv_failures  --duration_col adv_fit_time  --output data/merged_afr.csv
    deps:
    - path: afr.yaml
      hash: md5
      md5: 3649898b8dfd55def691c227ac478c34
      size: 9826
    - path: data/merged.csv
      hash: md5
      md5: f98b901fa3ee817a55a36f78d0c95233
      size: 124219079
    - path: plots/aft_comparison.tex
      hash: md5
      md5: f7fe1ebf5518ed3821836ec5eb607381
      size: 648
    outs:
    - path: data/merged_afr.csv
      hash: md5
      md5: e8c06cf834297c5ee44950ea4d640cc8
      size: 125347398
