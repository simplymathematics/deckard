schema: '2.0'
stages:
  train:
    cmd: python -m deckard.layers.experiment train
    params:
      params.yaml:
        data:
          _target_: deckard.base.data.Data
          generate:
            name: torch_cifar10
          sample:
            random_state: 0
            stratify: true
          sklearn_pipeline:
            preprocessor:
              name: sklearn.preprocessing.StandardScaler
              with_mean: true
              with_std: true
        files:
          _target_: deckard.base.files.FileConfig
          adv_predictions_file: adv_predictions.json
          attack_dir: attacks
          attack_file: attack
          attack_type: .pkl
          data_dir: data
          data_file: data
          data_type: .pkl
          directory: output
          model_dir: models
          model_file: model
          model_type: .pt
          name: default
          params_file: params.yaml
          predictions_file: predictions.json
          reports: reports
          score_dict_file: score_dict.json
        model:
          _target_: deckard.base.model.Model
          art:
            _target_: deckard.base.model.art_pipeline.ArtPipeline
            data:
              _target_: deckard.base.data.Data
              generate:
                name: torch_cifar10
              sample:
                random_state: 0
                stratify: true
              sklearn_pipeline:
                preprocessor:
                  name: sklearn.preprocessing.StandardScaler
                  with_mean: true
                  with_std: true
            initialize:
              clip_values:
              - 0.0
              - 1.0
              criterion:
                name: torch.nn.CrossEntropyLoss
              optimizer:
                lr: 0.01
                momentum: 0.9
                name: torch.optim.SGD
            library: pytorch
          data:
            _target_: deckard.base.data.Data
            generate:
              name: torch_cifar10
            sample:
              random_state: 0
              stratify: true
            sklearn_pipeline:
              preprocessor:
                name: sklearn.preprocessing.StandardScaler
                with_mean: true
                with_std: true
          init:
            _target_: deckard.base.model.ModelInitializer
            name: torch_example.ResNet18
          library: pytorch
          trainer:
            batch_size: 1024
            nb_epoch: 20
        scorers:
          _target_: deckard.base.scorer.ScorerDict
          accuracy:
            _target_: deckard.base.scorer.ScorerConfig
            direction: maximize
            name: sklearn.metrics.accuracy_score
          log_loss:
            _target_: deckard.base.scorer.ScorerConfig
            direction: minimize
            name: sklearn.metrics.log_loss
    outs:
    - path: output/data/data.pkl
      md5: 6503fed5d4e6cc1163898c0ab6a863dd
      size: 739680311
    - path: output/models/model.pt
      md5: 8cd16788ed8408f42c87a062d28747eb
      size: 44811029
    - path: output/reports/train/default/params.yaml
      md5: 920db8f93d5e2f930b00d3a682f524eb
      size: 2133
    - path: output/reports/train/default/predictions.json
      md5: a0eb991263f556afb38d1c6267b9211b
      size: 2436084
    - path: output/reports/train/default/score_dict.json
      md5: 696bc8c0fa4129026ad02b19ca7aef67
      size: 392
  attack:
    cmd: python -m deckard.layers.experiment attack
    deps:
    - path: output/data/data.pkl
      md5: 6503fed5d4e6cc1163898c0ab6a863dd
      size: 739680311
    - path: output/models/model.pt
      md5: a152a12cd129c5d8389dd093f25b3ccb
      size: 44811477
    params:
      params.yaml:
        attack:
          _target_: deckard.base.attack.Attack
          attack_size: 100
          data:
            _target_: deckard.base.data.Data
            generate:
              name: torch_cifar10
            sample:
              random_state: 0
              stratify: true
            sklearn_pipeline:
              preprocessor:
                name: sklearn.preprocessing.StandardScaler
                with_mean: true
                with_std: true
          init:
            _target_: deckard.base.attack.AttackInitializer
            model:
              _target_: deckard.base.model.Model
              art:
                _target_: deckard.base.model.art_pipeline.ArtPipeline
                data:
                  _target_: deckard.base.data.Data
                  generate:
                    name: torch_cifar10
                  sample:
                    random_state: 0
                    stratify: true
                  sklearn_pipeline:
                    preprocessor:
                      name: sklearn.preprocessing.StandardScaler
                      with_mean: true
                      with_std: true
                initialize:
                  clip_values:
                  - 0.0
                  - 1.0
                  criterion:
                    name: torch.nn.CrossEntropyLoss
                  optimizer:
                    lr: 0.01
                    momentum: 0.9
                    name: torch.optim.SGD
                library: pytorch
              data:
                _target_: deckard.base.data.Data
                generate:
                  name: torch_cifar10
                sample:
                  random_state: 0
                  stratify: true
                sklearn_pipeline:
                  preprocessor:
                    name: sklearn.preprocessing.StandardScaler
                    with_mean: true
                    with_std: true
              init:
                _target_: deckard.base.model.ModelInitializer
                name: torch_example.ResNet18
              library: pytorch
              trainer:
                batch_size: 1024
                nb_epoch: 20
            name: art.attacks.evasion.HopSkipJump
          method: evasion
          model:
            _target_: deckard.base.model.Model
            art:
              _target_: deckard.base.model.art_pipeline.ArtPipeline
              data:
                _target_: deckard.base.data.Data
                generate:
                  name: torch_cifar10
                sample:
                  random_state: 0
                  stratify: true
                sklearn_pipeline:
                  preprocessor:
                    name: sklearn.preprocessing.StandardScaler
                    with_mean: true
                    with_std: true
              initialize:
                clip_values:
                - 0.0
                - 1.0
                criterion:
                  name: torch.nn.CrossEntropyLoss
                optimizer:
                  lr: 0.01
                  momentum: 0.9
                  name: torch.optim.SGD
              library: pytorch
            data:
              _target_: deckard.base.data.Data
              generate:
                name: torch_cifar10
              sample:
                random_state: 0
                stratify: true
              sklearn_pipeline:
                preprocessor:
                  name: sklearn.preprocessing.StandardScaler
                  with_mean: true
                  with_std: true
            init:
              _target_: deckard.base.model.ModelInitializer
              name: torch_example.ResNet18
            library: pytorch
            trainer:
              batch_size: 1024
              nb_epoch: 20
        data.generate:
          name: torch_cifar10
        files:
          _target_: deckard.base.files.FileConfig
          adv_predictions_file: adv_predictions.json
          attack_dir: attacks
          attack_file: attack
          attack_type: .pkl
          data_dir: data
          data_file: data
          data_type: .pkl
          directory: output
          model_dir: models
          model_file: model
          model_type: .pt
          name: default
          params_file: params.yaml
          predictions_file: predictions.json
          reports: reports
          score_dict_file: score_dict.json
        model:
          _target_: deckard.base.model.Model
          art:
            _target_: deckard.base.model.art_pipeline.ArtPipeline
            data:
              _target_: deckard.base.data.Data
              generate:
                name: torch_cifar10
              sample:
                random_state: 0
                stratify: true
              sklearn_pipeline:
                preprocessor:
                  name: sklearn.preprocessing.StandardScaler
                  with_mean: true
                  with_std: true
            initialize:
              clip_values:
              - 0.0
              - 1.0
              criterion:
                name: torch.nn.CrossEntropyLoss
              optimizer:
                lr: 0.01
                momentum: 0.9
                name: torch.optim.SGD
            library: pytorch
          data:
            _target_: deckard.base.data.Data
            generate:
              name: torch_cifar10
            sample:
              random_state: 0
              stratify: true
            sklearn_pipeline:
              preprocessor:
                name: sklearn.preprocessing.StandardScaler
                with_mean: true
                with_std: true
          init:
            _target_: deckard.base.model.ModelInitializer
            name: torch_example.ResNet18
          library: pytorch
          trainer:
            batch_size: 1024
            nb_epoch: 20
        scorers:
          _target_: deckard.base.scorer.ScorerDict
          accuracy:
            _target_: deckard.base.scorer.ScorerConfig
            direction: maximize
            name: sklearn.metrics.accuracy_score
          log_loss:
            _target_: deckard.base.scorer.ScorerConfig
            direction: minimize
            name: sklearn.metrics.log_loss
    outs:
    - path: output/attacks/attack.pkl
      md5: dbb70ab0e428c1b3370cb1795947f79d
      size: 1228966
    - path: output/reports/attack/default/adv_predictions.json
      md5: 2570871a6fb261fbcfc12b2493f81297
      size: 21895
    - path: output/reports/attack/default/params.yaml
      md5: ba02fa64b136a4eee498014907161e1c
      size: 4870
    - path: output/reports/attack/default/score_dict.json
      md5: 77be648b8b9a181febf04456e7e55282
      size: 525
  models:
    cmd: bash models.sh --config-name grid.yaml
    deps:
    - path: output/data/data.pkl
      md5: 6503fed5d4e6cc1163898c0ab6a863dd
      size: 739680311
    - path: output/models/model.pt
      md5: 6a8c3706076548fb337eb8d4fa814396
      size: 44811477
    outs:
    - path: model.db
      md5: 036f26eb0fc5ef7651119927d1b7dbc2
      size: 188416
  attacks:
    cmd: bash attacks.sh ++stage=attack --config-name grid.yaml
    deps:
    - path: model.db
      md5: 036f26eb0fc5ef7651119927d1b7dbc2
      size: 188416
    - path: output/data/data.pkl
      md5: 6503fed5d4e6cc1163898c0ab6a863dd
      size: 739680311
    - path: output/models/model.pt
      md5: 6a8c3706076548fb337eb8d4fa814396
      size: 44811477
    outs:
    - path: attack.db
      md5: de4d365f35bce33ef692868f9dba1237
      size: 667648
  compile_train:
    cmd: python -m deckard.layers.compile --report_folder output/reports/train/ --results_file
      output/reports/train.csv
    deps:
    - path: model.db
      md5: e5dc2d529f4841baf9cccedd7b417988
      size: 110592
    - path: output/data/
      md5: 0078b738d3ac5d26c4c487d9c43903da.dir
      size: 1111601555
      nfiles: 5
    - path: output/models/
      md5: 2dc57f423c263fa18830ef6d532f592f.dir
      size: 1074846
      nfiles: 14
    outs:
    - path: output/reports/train.csv
      md5: 54707302f1ee42d25231d73ee2c03cf3
      size: 12177
  compile_attack:
    cmd: python -m deckard.layers.compile --report_folder output/reports/attack/ --results_file
      output/reports/attack.csv
    deps:
    - path: attack.db
      md5: 576e07b1a496218659b7a425a812412b
      size: 319488
    - path: output/attacks/
      md5: f6967d943832917c2b1e0db449d514f7.dir
      size: 336979704
      nfiles: 1044
    - path: output/data/
      md5: 837a1c3acf188d7955e48419b38d8135.dir
      size: 2445523421
      nfiles: 11
    - path: output/models/
      md5: 33fa241d9672dfc7f7f27927869d4948.dir
      size: 160466396
      nfiles: 2088
    outs:
    - path: output/reports/attack.csv
      md5: 36ffafc8cb80eb6fbed190be9d420ef7
      size: 3674355
  compile@attack:
    cmd: python -m deckard.layers.compile --report_folder output/reports/attack --results_file
      output/reports/attack.csv
    deps:
    - path: model.db
      md5: 036f26eb0fc5ef7651119927d1b7dbc2
      size: 188416
    - path: output/reports/attack/
      md5: 3ddc06bf42158ee654409d14a84f5ed6.dir
      size: 1728030532
      nfiles: 2913
    outs:
    - path: output/reports/attack.csv
      md5: ec5e3638a9302f339f7e3caddc8d406a
      size: 2066258
  compile@train:
    cmd: python -m deckard.layers.compile --report_folder output/reports/train --results_file
      output/reports/train.csv
    deps:
    - path: model.db
      md5: 036f26eb0fc5ef7651119927d1b7dbc2
      size: 188416
    - path: output/reports/train/
      md5: a218b7e4704bc207fa4b57827f6061c9.dir
      size: 238379001
      nfiles: 352
    outs:
    - path: output/reports/train.csv
      md5: e4e0ef332634b946c69a78778023515e
      size: 216705
