schema: '2.0'
stages:
  merge@mnist:
    cmd: python merge.py  --big_dir data/bit_depth/mnist --little_dir data/mnist --config
      ../conf/afr.yaml --data_file power.csv --output_folder mnist/ --output_file
      merged.csv
    deps:
    - path: ../conf/clean.yaml
      hash: md5
      md5: 3b23a3d656ad56e49e69f8624e227852
      size: 513
    - path: data/bit_depth/mnist/power.csv
      hash: md5
      md5: ed40bca679961759527ca94ca4cbd984
      size: 5421537
    - path: data/mnist/power.csv
      hash: md5
      md5: 6c84e8e91d81504e86db933bab0e9ae2
      size: 9968081
    params:
      ../conf/clean.yaml:
        fillna:
          Epochs: 20
          FGM: 0.0
          FSQ: 32
          Control: 18
          Batch_Size: 1024
    outs:
    - path: mnist/merged.csv
      hash: md5
      md5: 8f227012f75f50d6f01745b54d2dc5a5
      size: 15408533
  merge@cifar:
    cmd: python merge.py  --big_dir data/bit_depth/cifar --little_dir data/cifar --config
      ../conf/afr.yaml --data_file power.csv --output_folder cifar/ --output_file
      merged.csv
    deps:
    - path: ../conf/clean.yaml
      hash: md5
      md5: 3b23a3d656ad56e49e69f8624e227852
      size: 513
    - path: data/bit_depth/cifar/power.csv
      hash: md5
      md5: b9ebbe01b2bd93f1c4af02fb8abd910b
      size: 5291011
    - path: data/cifar/power.csv
      hash: md5
      md5: a8e056a8c4008ce37006237f2e44b2bf
      size: 9997291
    params:
      ../conf/clean.yaml:
        fillna:
          Epochs: 20
          FGM: 0.0
          FSQ: 32
          Control: 18
          Batch_Size: 1024
    outs:
    - path: cifar/merged.csv
      hash: md5
      md5: 2d2cbcb913a61d304950c910bd487b9b
      size: 15304603
  merge@cifar100:
    cmd: python merge.py  --big_dir data/bit_depth/cifar100 --little_dir data/cifar100
      --config ../conf/afr.yaml --data_file power.csv --output_folder cifar100/ --output_file
      merged.csv
    deps:
    - path: ../conf/clean.yaml
      hash: md5
      md5: 3b23a3d656ad56e49e69f8624e227852
      size: 513
    - path: data/bit_depth/cifar100/power.csv
      hash: md5
      md5: d52080413e3ba7bd86ef8d92ebd00507
      size: 3987447
    - path: data/cifar100/power.csv
      hash: md5
      md5: f51f0d4ebd105f64829af90a0212de00
      size: 16081846
    params:
      ../conf/clean.yaml:
        fillna:
          Epochs: 20
          FGM: 0.0
          FSQ: 32
          Control: 18
          Batch_Size: 1024
    outs:
    - path: cifar100/merged.csv
      hash: md5
      md5: f2bf33451a3c6a27e8b37dafc2a30ace
      size: 20099761
  clean@mnist:
    cmd: python -m deckard.layers.clean_data --i mnist/merged.csv --o mnist/clean.csv
      --config "../conf/clean.yaml"
    deps:
    - path: ../conf/clean.yaml
      hash: md5
      md5: 3b23a3d656ad56e49e69f8624e227852
      size: 513
    - path: mnist/merged.csv
      hash: md5
      md5: 8f227012f75f50d6f01745b54d2dc5a5
      size: 15408533
    params:
      ../conf/clean.yaml:
        attacks:
          FastGradientMethod: FGM
          ProjectedGradientDescent: PGD
          HopSkipJump: HSJ
          DeepFool: Deep
        defences:
          Control: Control
          FeatureSqueezing: FSQ
          Epochs: Epochs
          model_layers: Control
        fillna:
          Epochs: 20
          FGM: 0.0
          FSQ: 32
          Control: 18
          Batch_Size: 1024
        params:
          FGM: attack.init.eps
          PGD: attack.init.eps
          HSJ: attack.init.eps
          DeepFool: attack.init.eps
          FSQ: model.art.preprocessor.bit_depth
          Control: model_layers
          Epochs: model.trainer.nb_epoch
          Batch_Size: model.trainer.batch_size
    outs:
    - path: mnist/clean.csv
      hash: md5
      md5: 4dfbcdb8c5aa27976ec2811ea9c1fda6
      size: 9294911
  clean@cifar:
    cmd: python -m deckard.layers.clean_data --i cifar/merged.csv --o cifar/clean.csv
      --config "../conf/clean.yaml"
    deps:
    - path: ../conf/clean.yaml
      hash: md5
      md5: 3b23a3d656ad56e49e69f8624e227852
      size: 513
    - path: cifar/merged.csv
      hash: md5
      md5: 2d2cbcb913a61d304950c910bd487b9b
      size: 15304603
    params:
      ../conf/clean.yaml:
        attacks:
          FastGradientMethod: FGM
          ProjectedGradientDescent: PGD
          HopSkipJump: HSJ
          DeepFool: Deep
        defences:
          Control: Control
          FeatureSqueezing: FSQ
          Epochs: Epochs
          model_layers: Control
        fillna:
          Epochs: 20
          FGM: 0.0
          FSQ: 32
          Control: 18
          Batch_Size: 1024
        params:
          FGM: attack.init.eps
          PGD: attack.init.eps
          HSJ: attack.init.eps
          DeepFool: attack.init.eps
          FSQ: model.art.preprocessor.bit_depth
          Control: model_layers
          Epochs: model.trainer.nb_epoch
          Batch_Size: model.trainer.batch_size
    outs:
    - path: cifar/clean.csv
      hash: md5
      md5: c546fa08ebcc159fd81fcaa5dda11411
      size: 9305692
  clean@cifar100:
    cmd: python -m deckard.layers.clean_data --i cifar100/merged.csv --o cifar100/clean.csv
      --config "../conf/clean.yaml"
    deps:
    - path: ../conf/clean.yaml
      hash: md5
      md5: 3b23a3d656ad56e49e69f8624e227852
      size: 513
    - path: cifar100/merged.csv
      hash: md5
      md5: f2bf33451a3c6a27e8b37dafc2a30ace
      size: 20099761
    params:
      ../conf/clean.yaml:
        attacks:
          FastGradientMethod: FGM
          ProjectedGradientDescent: PGD
          HopSkipJump: HSJ
          DeepFool: Deep
        defences:
          Control: Control
          FeatureSqueezing: FSQ
          Epochs: Epochs
          model_layers: Control
        fillna:
          Epochs: 20
          FGM: 0.0
          FSQ: 32
          Control: 18
          Batch_Size: 1024
        params:
          FGM: attack.init.eps
          PGD: attack.init.eps
          HSJ: attack.init.eps
          DeepFool: attack.init.eps
          FSQ: model.art.preprocessor.bit_depth
          Control: model_layers
          Epochs: model.trainer.nb_epoch
          Batch_Size: model.trainer.batch_size
    outs:
    - path: cifar100/clean.csv
      hash: md5
      md5: d020a3f4406f0f6091ea8f09ea67b824
      size: 9318360
  afr@mnist:
    cmd: python -m deckard.layers.afr --dataset mnist --data_file mnist/clean.csv
      --config_file "../conf/afr.yaml" --plots_folder mnist/ --target adv_failures
      --duration_col adv_fit_time
    deps:
    - path: ../conf/afr.yaml
      hash: md5
      md5: 061aa289da159a323139555e472391da
      size: 5666
    - path: mnist/clean.csv
      hash: md5
      md5: 4dfbcdb8c5aa27976ec2811ea9c1fda6
      size: 9294911
    outs:
    - path: mnist/aft_comparison.csv
      hash: md5
      md5: f6e0ce8c6d214014261fb52b1566ce1c
      size: 263
    - path: mnist/aft_comparison.tex
      hash: md5
      md5: 83287d600aa7abcda0314c23ffe7e49f
      size: 537
    - path: mnist/cox_aft.pdf
      hash: md5
      md5: 2a375c565771c5170b83bf8682ce0879
      size: 22975
    - path: mnist/cox_epochs_partial_effect.pdf
      hash: md5
      md5: 3e7fcb0f9f4dc1df6e6b8566eec0b288
      size: 26648
    - path: mnist/log_logistic_aft.pdf
      hash: md5
      md5: e50e0e1df87569c431ebc26435b6b2da
      size: 22830
    - path: mnist/log_logistic_epochs_partial_effect.pdf
      hash: md5
      md5: d092c827c142b10afc1781896601cad4
      size: 24701
    - path: mnist/log_normal_aft.pdf
      hash: md5
      md5: e905a789136a0f46041a1bb1278721f7
      size: 23162
    - path: mnist/log_normal_epochs_partial_effect.pdf
      hash: md5
      md5: 6c2338fb5be277f30aef9c14af0ddb0c
      size: 25406
    - path: mnist/weibull_aft.pdf
      hash: md5
      md5: bf80ddccf2955ee7c62d6dabf4eec0c7
      size: 22966
    - path: mnist/weibull_epochs_partial_effect.pdf
      hash: md5
      md5: d8c3d9fd70627757e25b53b22ec7d4d5
      size: 24391
  afr@cifar:
    cmd: python -m deckard.layers.afr --dataset cifar --data_file cifar/clean.csv
      --config_file "../conf/afr.yaml" --plots_folder cifar/ --target adv_failures
      --duration_col adv_fit_time
    deps:
    - path: ../conf/afr.yaml
      hash: md5
      md5: 061aa289da159a323139555e472391da
      size: 5666
    - path: cifar/clean.csv
      hash: md5
      md5: c546fa08ebcc159fd81fcaa5dda11411
      size: 9305692
    outs:
    - path: cifar/aft_comparison.csv
      hash: md5
      md5: 11751a71d62d6c7eceed779537b20a3b
      size: 266
    - path: cifar/aft_comparison.tex
      hash: md5
      md5: e8bd848301a3769eb655267f6b66584e
      size: 536
    - path: cifar/cox_aft.pdf
      hash: md5
      md5: 931714309f4975861fe6c2a4922b9581
      size: 22624
    - path: cifar/cox_epochs_partial_effect.pdf
      hash: md5
      md5: a59da4db516d03dc7dca05dd6c7e61ff
      size: 26815
    - path: cifar/log_logistic_aft.pdf
      hash: md5
      md5: f3ec36929f8226fad16ff17e26502abd
      size: 22841
    - path: cifar/log_logistic_epochs_partial_effect.pdf
      hash: md5
      md5: fcff8d8cb1b02ca3517fa8897a5dc21e
      size: 25011
    - path: cifar/log_normal_aft.pdf
      hash: md5
      md5: c8ee1a0fbd63e776940ab21d8ea925c7
      size: 22877
    - path: cifar/log_normal_epochs_partial_effect.pdf
      hash: md5
      md5: 25e88898570251cdc7396da19ea074d3
      size: 25594
    - path: cifar/weibull_aft.pdf
      hash: md5
      md5: 59682f49498270070d3c146a516e6de5
      size: 22972
    - path: cifar/weibull_epochs_partial_effect.pdf
      hash: md5
      md5: e5e321468e817ebc0c69ac6e21d3e06c
      size: 24538
  afr@cifar100:
    cmd: python -m deckard.layers.afr --dataset cifar100 --data_file cifar100/clean.csv
      --config_file "../conf/afr.yaml" --plots_folder cifar100/ --target adv_failures
      --duration_col adv_fit_time
    deps:
    - path: ../conf/afr.yaml
      hash: md5
      md5: 061aa289da159a323139555e472391da
      size: 5666
    - path: cifar100/clean.csv
      hash: md5
      md5: d020a3f4406f0f6091ea8f09ea67b824
      size: 9318360
    outs:
    - path: cifar100/aft_comparison.csv
      hash: md5
      md5: 2a5187500f67a2d6eec01726376eac34
      size: 262
    - path: cifar100/aft_comparison.tex
      hash: md5
      md5: 01965140c4b468981caa0d4591084ef7
      size: 535
    - path: cifar100/cox_aft.pdf
      hash: md5
      md5: a9a5777f234e898e8e91217761795ff5
      size: 22606
    - path: cifar100/cox_epochs_partial_effect.pdf
      hash: md5
      md5: f1555ed271aff80db706d502464635bf
      size: 29741
    - path: cifar100/log_logistic_aft.pdf
      hash: md5
      md5: 007d13adf1d37432a5b077d849d13751
      size: 22542
    - path: cifar100/log_logistic_epochs_partial_effect.pdf
      hash: md5
      md5: 5b0b98ae74048b030807e502ad985f17
      size: 24827
    - path: cifar100/log_normal_aft.pdf
      hash: md5
      md5: 81a9dc3ba1bc3569f46fa22960f13835
      size: 22865
    - path: cifar100/log_normal_epochs_partial_effect.pdf
      hash: md5
      md5: e36e8227ccdc649d81dc76d21ae7195a
      size: 25516
    - path: cifar100/weibull_aft.pdf
      hash: md5
      md5: 71b59249773b586786da5b9114edc1aa
      size: 22989
    - path: cifar100/weibull_epochs_partial_effect.pdf
      hash: md5
      md5: 5a04e39e289ab15fb25178633ef55238
      size: 24305
  combined_plots:
    cmd: python combined_plots.py
    deps:
    - path: cifar/aft_comparison.csv
      hash: md5
      md5: 11751a71d62d6c7eceed779537b20a3b
      size: 266
    - path: cifar100/aft_comparison.csv
      hash: md5
      md5: 2a5187500f67a2d6eec01726376eac34
      size: 262
    - path: combined_plots.py
      hash: md5
      md5: 9b0bec1a5faf2d1965895d1e88887cdc
      size: 9011
    - path: mnist/aft_comparison.csv
      hash: md5
      md5: f6e0ce8c6d214014261fb52b1566ce1c
      size: 263
    outs:
    - path: combined/acc.pdf
      hash: md5
      md5: 4aa881cdccff52f300d1f2c17b635094
      size: 27363
    - path: combined/cost.pdf
      hash: md5
      md5: 3d152ec0822738343a1f0ba497084b21
      size: 43068
    - path: combined/power.pdf
      hash: md5
      md5: 1e7e15f5a4ca09df5272c1f0c06801cd
      size: 42356
    - path: combined/time.pdf
      hash: md5
      md5: e8b1991d18ac37de84d9a6353ce59a8a
      size: 42366
    - path: data/combined/combined.csv
      hash: md5
      md5: 5373a0cba09196ebf00bbfbab9378398
      size: 52639498
  combined_clean:
    cmd: python -m deckard.layers.clean_data --i data/combined/combined.csv --o combined/clean.csv
      --config "../conf/clean.yaml"
    deps:
    - path: ../conf/clean.yaml
      hash: md5
      md5: 3b23a3d656ad56e49e69f8624e227852
      size: 513
    - path: data/combined/combined.csv
      hash: md5
      md5: 5373a0cba09196ebf00bbfbab9378398
      size: 52639498
    params:
      ../conf/clean.yaml:
        attacks:
          FastGradientMethod: FGM
          ProjectedGradientDescent: PGD
          HopSkipJump: HSJ
          DeepFool: Deep
        defences:
          Control: Control
          FeatureSqueezing: FSQ
          Epochs: Epochs
          model_layers: Control
        fillna:
          Epochs: 20
          FGM: 0.0
          FSQ: 32
          Control: 18
          Batch_Size: 1024
        params:
          FGM: attack.init.eps
          PGD: attack.init.eps
          HSJ: attack.init.eps
          DeepFool: attack.init.eps
          FSQ: model.art.preprocessor.bit_depth
          Control: model_layers
          Epochs: model.trainer.nb_epoch
          Batch_Size: model.trainer.batch_size
    outs:
    - path: combined/clean.csv
      hash: md5
      md5: 15c348d9d5a89c9637e80062dc0af99a
      size: 37267652
  combined_afr:
    cmd: python -m deckard.layers.afr --dataset Combined --data_file combined/clean.csv
      --config_file "../conf/combined_afr.yaml" --plots_folder combined/ --target
      adv_failures --duration_col adv_fit_time
    deps:
    - path: ../conf/combined_afr.yaml
      hash: md5
      md5: 4d86bafe5b29b5a38918fc2d70126542
      size: 5004
    - path: combined/clean.csv
      hash: md5
      md5: 15c348d9d5a89c9637e80062dc0af99a
      size: 37267652
    outs:
    - path: combined/aft_comparison.csv
      hash: md5
      md5: d02089bb218d16ba7de45125669a7b23
      size: 271
    - path: combined/aft_comparison.tex
      hash: md5
      md5: 5f35183b101579959f517e6da4299e53
      size: 542
    - path: combined/log_logistic_aft.pdf
      hash: md5
      md5: b6e7d5ac76d9e49b1e13c12bcc5898bc
      size: 28656
    - path: combined/log_logistic_qq.pdf
      hash: md5
      md5: 557357bcbca13343b85918072902c037
      size: 17236
    - path: combined/log_logistic_summary.csv
      hash: md5
      md5: f5291c939b61e9fd768265d804a47e95
      size: 3401
    - path: combined/log_normal_aft.pdf
      hash: md5
      md5: c5551e63d2ac7ccf48ec510b8c30fc59
      size: 28815
    - path: combined/log_normal_qq.pdf
      hash: md5
      md5: d45bf39c79a4c4e4db329d181495fd30
      size: 18768
    - path: combined/log_normal_summary.csv
      hash: md5
      md5: cdc94cc5f4399c2cf4897035d26b745d
      size: 3370
    - path: combined/weibull_aft.pdf
      hash: md5
      md5: 0a093a5ba4cacba2fb080a437fea2d85
      size: 28811
    - path: combined/weibull_qq.pdf
      hash: md5
      md5: 1994918d9a45ea52d03b212fb356e982
      size: 16977
    - path: combined/weibull_summary.csv
      hash: md5
      md5: 57816c0c1036b75a65a6cd618d550e49
      size: 3416
  copy@mnist:
    cmd: rm -rf ~/kepler-ml/plots/mnist/ && mkdir -p ~/kepler-ml/plots/mnist/ && cp
      -r mnist/* ~/kepler-ml/plots/mnist/
    deps:
    - path: mnist/
      hash: md5
      md5: e890c4a72a727a0a6251cddccd9d0288.dir
      size: 25106281
      nfiles: 24
  copy@cifar:
    cmd: rm -rf ~/kepler-ml/plots/cifar/ && mkdir -p ~/kepler-ml/plots/cifar/ && cp
      -r cifar/* ~/kepler-ml/plots/cifar/
    deps:
    - path: cifar/
      hash: md5
      md5: fc72e1b81079a2820cc993127bc09a85.dir
      size: 25012945
      nfiles: 24
  copy@cifar100:
    cmd: rm -rf ~/kepler-ml/plots/cifar100/ && mkdir -p ~/kepler-ml/plots/cifar100/
      && cp -r cifar100/* ~/kepler-ml/plots/cifar100/
    deps:
    - path: cifar100/
      hash: md5
      md5: 3b78f975b5712664f49133e29d708163.dir
      size: 29822135
      nfiles: 24
  copy@combined:
    cmd: rm -rf ~/kepler-ml/plots/combined/ && mkdir -p ~/kepler-ml/plots/combined/
      && cp -r combined/* ~/kepler-ml/plots/combined/
    deps:
    - path: combined/
      hash: md5
      md5: ba1c4591fa5234e4cdc12ca0f70e5cc5.dir
      size: 151069769
      nfiles: 50
  predict_survival_time@weibull:
    cmd: python predict_with_best.py  --data combined/clean.csv  --config_file ../conf/combined_afr.yaml  --model
      weibull --target adv_failures  --duration_col adv_fit_time --output combined/weibull.csv
    deps:
    - path: ../conf/combined_afr.yaml
      hash: md5
      md5: 4d86bafe5b29b5a38918fc2d70126542
      size: 5004
    - path: combined/aft_comparison.tex
      hash: md5
      md5: 5f35183b101579959f517e6da4299e53
      size: 542
    - path: combined/clean.csv
      hash: md5
      md5: 15c348d9d5a89c9637e80062dc0af99a
      size: 37267652
    - path: predict_with_best.py
      hash: md5
      md5: 178074244d30f7eecf7c1eae65d8ffa9
      size: 2557
    outs:
    - path: combined/weibull.csv
      hash: md5
      md5: 90709af7e1358d4463a19c5f891e79fd
      size: 37565381
  predict_survival_time@log_normal:
    cmd: python predict_with_best.py  --data combined/clean.csv  --config_file ../conf/combined_afr.yaml  --model
      log_normal --target adv_failures  --duration_col adv_fit_time --output combined/log_normal.csv
    deps:
    - path: ../conf/combined_afr.yaml
      hash: md5
      md5: 4d86bafe5b29b5a38918fc2d70126542
      size: 5004
    - path: combined/aft_comparison.tex
      hash: md5
      md5: 5f35183b101579959f517e6da4299e53
      size: 542
    - path: combined/clean.csv
      hash: md5
      md5: 15c348d9d5a89c9637e80062dc0af99a
      size: 37267652
    - path: predict_with_best.py
      hash: md5
      md5: 178074244d30f7eecf7c1eae65d8ffa9
      size: 2557
    outs:
    - path: combined/log_normal.csv
      hash: md5
      md5: ce71a51047d24c93af4f5df60bf4cc43
      size: 37565362
  predict_survival_time@log_logistic:
    cmd: python predict_with_best.py  --data combined/clean.csv  --config_file ../conf/combined_afr.yaml  --model
      log_logistic --target adv_failures  --duration_col adv_fit_time --output combined/log_logistic.csv
    deps:
    - path: ../conf/combined_afr.yaml
      hash: md5
      md5: 4d86bafe5b29b5a38918fc2d70126542
      size: 5004
    - path: combined/aft_comparison.tex
      hash: md5
      md5: 5f35183b101579959f517e6da4299e53
      size: 542
    - path: combined/clean.csv
      hash: md5
      md5: 15c348d9d5a89c9637e80062dc0af99a
      size: 37267652
    - path: predict_with_best.py
      hash: md5
      md5: 178074244d30f7eecf7c1eae65d8ffa9
      size: 2557
    outs:
    - path: combined/log_logistic.csv
      hash: md5
      md5: 6b4842aae2a8bd7ab52307b67e9d3eed
      size: 37565421
  plot_trash_score@weibull:
    cmd: python plot_trash_score.py  --input_file combined/weibull.csv  --output_file
      combined/weibull_trash_score.pdf --title weibull
    deps:
    - path: combined/weibull.csv
      hash: md5
      md5: 90709af7e1358d4463a19c5f891e79fd
      size: 37565381
    - path: plot_trash_score.py
      hash: md5
      md5: 88bdbe97492eab9e01105628fc33038e
      size: 1660
    outs:
    - path: combined/weibull_trash_score.pdf
      hash: md5
      md5: 177e8c8a0b1bae82fa7fac49ad98271f
      size: 22242
  plot_trash_score@log_normal:
    cmd: python plot_trash_score.py  --input_file combined/log_normal.csv  --output_file
      combined/log_normal_trash_score.pdf --title log_normal
    deps:
    - path: combined/log_normal.csv
      hash: md5
      md5: ce71a51047d24c93af4f5df60bf4cc43
      size: 37565362
    - path: plot_trash_score.py
      hash: md5
      md5: 88bdbe97492eab9e01105628fc33038e
      size: 1660
    outs:
    - path: combined/log_normal_trash_score.pdf
      hash: md5
      md5: 2d589d2818995412f604e33bf21be26c
      size: 22724
  plot_trash_score@log_logistic:
    cmd: python plot_trash_score.py  --input_file combined/log_logistic.csv  --output_file
      combined/log_logistic_trash_score.pdf --title log_logistic
    deps:
    - path: combined/log_logistic.csv
      hash: md5
      md5: 6b4842aae2a8bd7ab52307b67e9d3eed
      size: 37565421
    - path: plot_trash_score.py
      hash: md5
      md5: 88bdbe97492eab9e01105628fc33038e
      size: 1660
    outs:
    - path: combined/log_logistic_trash_score.pdf
      hash: md5
      md5: 404daeaa28985623331f160ec67b5360
      size: 22023
